!function(e){function t(){var e=document.currentScript;if(!e){var t=document.scripts;e=t[t.length-1]}return e}function r(e,t,r){var n=e[t];e[t]=r(n)}function n(e){return"function"!=typeof e?e:(e.__injected__||(e.__injected__=function(){try{return e.apply(this,arguments)}catch(e){throw s(e),E=!0,e}}),e.__injected__)}function a(e){var t=/^[0-9a-z]{64}$/i;return!(!e||!e.match(t))}function i(e){return e?{name:e&&e.name,message:e&&e.message,fileName:e&&e.fileName||e&&e.sourceURL,lineNumber:e&&e.lineNumber||e&&e.line,columnNumber:e&&e.columnNumber||e&&e.column}:null}function o(){var e;try{throw new Error("")}catch(t){e=t.stack}if(e)return e=e.replace(/(.*?)fundebug(.*?)\.js(.*)\n?/gm,""),e=e.replace(/^Error\n/g,""),e="generated-stack:\n"+e}function u(){for(var e,t=[],r=arguments.callee.caller.caller;r&&t.length<10;){var n=r.toString().match(/function\s*([\w\_$]+)?\s*\(/i);e=n&&n[1]||"[anonymous]",t.push(e),r=r.caller}return"generated-stack:\n"+t.join("\n")}function s(e){if(e){var t=e.stack;t=t.replace(/(.*?)fundebug(.*?)\.js(.*)\n?/gm,"");var r=i(e);h({name:r.name||"uncaught error",message:r.message,fileName:r.fileName,lineNumber:r.lineNumber,columnNumber:r.columnNumber,stacktrace:t,severity:"error",type:"uncaught"})}}function c(e){var t=[];for(var r in e)if(e.hasOwnProperty(r)){var n='"'+r+'":',a=e[r];a&&("object"==typeof a?n+=c(a):"number"==typeof a?n+=a:n=n+'"'+a.replace(/\n/g,"\\n")+'"',t.push(n))}return"{"+t.join(",")+"}"}function l(t){var r;r=t.target?t.target:t.srcElement;var n=r&&r.outerHTML;n&&n.length>200&&(n=n.slice(0,200));var a={type:"resourceError",target:{outerHTML:n,src:r&&r.src,tagName:r&&r.tagName,id:r&&r.id,className:r&&r.className,name:r&&r.name,type:r&&r.type,XPath:m(r),selector:f(r)}};if(r.src!==e.location.href&&(!r.src||!r.src.match(/.*\/(.*)$/)||r.src.match(/.*\/(.*)$/)[1])&&a.target.src&&e.XMLHttpRequest){var i=new XMLHttpRequest;i.Fundebug=!0,i.open("HEAD",a.target.src),i.send(),i.onload=function(e){200!==e.target.status&&(a.target.status=e.target.status,a.target.statusText=e.target.statusText),h(a)}}}function m(e){for(var t=[];e&&e.nodeType==Node.ELEMENT_NODE;e=e.parentNode){var r,n=0,a=!1;for(r=e.previousSibling;r;r=r.previousSibling)r.nodeType!=Node.DOCUMENT_TYPE_NODE&&r.nodeName==e.nodeName&&++n;for(r=e.nextSibling;r&&!a;r=r.nextSibling)r.nodeName==e.nodeName&&(a=!0);var i=(e.prefix?e.prefix+":":"")+e.localName,o=n||a?"["+(n+1)+"]":"";t.splice(0,0,i+o)}return t.length?"/"+t.join("/"):null}function f(e){for(var t=[];e.parentNode;){if(e.id){t.unshift("#"+e.id);break}if(e==e.ownerDocument.documentElement)t.unshift(e.tagName);else{for(var r=1,n=e;n.previousElementSibling;n=n.previousElementSibling,r++);t.unshift(e.tagName+":nth-child("+r+")")}e=e.parentNode}return t.join(" > ")}function p(e){k.push(e),k.length>20&&k.shift()}function d(t){var r;r=t.target?t.target:t.srcElement;var n=r&&r.outerHTML;n&&n.length>200&&(n=n.slice(0,200)),p({type:"click",page:{url:e.location.href,title:document.title},detail:{outerHTML:n,tagName:r&&r.tagName,id:r&&r.id,className:r&&r.className,name:r&&r.name},time:(new Date).getTime()})}function g(e,t){D=t,p({type:"navigation",detail:{from:e,to:t},time:(new Date).getTime()})}function v(e){return!b.silentHttp&&((0!==e.detail.status||!/^file:\/\/\//.test(e.detail.url))&&2!==parseInt(e.detail.status/100))}function h(t){if(a(T.getAttribute("apikey")||b.apikey)&&b.maxEventNumber&&!b.silent){b.maxEventNumber-=1;var r={notifierVersion:"0.1.11",userAgent:e.navigator.userAgent,locale:e.navigator.language||e.navigator.userLanguage,url:e.location.href,title:document.title,appVersion:T.getAttribute("appversion")||b.appversion,apiKey:T.getAttribute("apikey")||b.apikey,releaseStage:T.getAttribute("releasestage")||b.releasestage,metaData:t.metaData||b.metaData,user:t.user||b.user,name:t.name,time:(new Date).getTime(),message:t.message,fileName:t.fileName,lineNumber:t.lineNumber,columnNumber:t.columnNumber,stacktrace:t.stacktrace,type:t.type,severity:t.severity,target:t.target,req:t.req,res:t.res,breadcrumbs:k};r.userAgent&&r.userAgent.match(/Googlebot/)||y(r)}}function y(t){var r,n="https://fundebug.com/javascript/";if(r="undefined"==typeof JSON?c(t):JSON.stringify(t),e.XMLHttpRequest&&e.atob){var a=new XMLHttpRequest;a.Fundebug=!0,a.open("POST",n),a.setRequestHeader("Content-Type","application/json"),a.send(r)}else{(new Image).src=N+"?event="+encodeURIComponent(r)}}var N="https://fundebug.com/javascript/",b={};e.fundebug=b;var E=!1,T=t();b.silent=T.getAttribute("silent")||!1,b.maxEventNumber=T.getAttribute("maxEventNumber")||10,b.silentResource=T.getAttribute("silentResource")||!1,b.silentHttp=T.getAttribute("silentHttp")||!1,r(e,"onerror",function(){return function(t,r,n,a,o){if(E)return void(E=!1);void 0===a&&e.event&&(a=e.event.errorCharacter);var s;s=r&&r!==e.location.href?r:null;var c=i(o);h({message:t,lineNumber:n,columnNumber:a,fileName:s||c&&c.fileName,name:c&&c.name||"uncaught error",stacktrace:o&&o.stack||u(),severity:"error",type:"uncaught"})}});var L=!0;if(e.atob){if(e.ErrorEvent)try{e.ErrorEvent.prototype.hasOwnProperty("error")&&(L=!1)}catch(e){}}else L=!1;"EventTarget Window Node ApplicationCache AudioTrackList ChannelMergerNode CryptoOperation EventSource FileReader HTMLUnknownElement IDBDatabase IDBRequest IDBTransaction KeyOperation MediaController MessagePort ModalWindow Notification SVGElementInstance Screen TextTrack TextTrackCue TextTrackList WebSocket WebSocketWorker Worker XMLHttpRequest XMLHttpRequestEventTarget XMLHttpRequestUpload".replace(/\w+/g,function(t){if(L){var a=e[t]&&e[t].prototype;a&&a.hasOwnProperty&&a.hasOwnProperty("addEventListener")&&(r(a,"addEventListener",function(e){return function(t,r,a,i){return r&&r.handleEvent&&(r.handleEvent=n(r.handleEvent)),e.call(this,t,n(r),a,i)}}),r(a,"removeEventListener",function(e){return function(t,r,a){return e.call(this,t,r,a),e.call(this,t,n(r),a)}}))}}),b.notify=function(e,t,r){if(e){return h({name:e||r&&r.name,message:t||r&&r.message,severity:r&&r.message||"warning",stacktrace:o(),type:"notification",user:r&&r.user,metaData:r&&r.metaData}),"fundebug.com"===location.host?"亲，不要在Fundebug网站测试哦；请将Fundebug插件集成到您的网站，然后进行测试!":"请查看邮箱以及Fundebug控制台!"}},b.notifyError=function(e,t){if(e){var r=i(e);h({name:r.name||t&&t.name||"caught error",message:r.message||t&&t.message,stacktrace:e.stack,fileName:r.fileName,lineNumber:r.lineNumber,columnNumber:r.columnNumber,severity:t&&t.severity||"error",type:"caught",user:t&&t.user,metaData:t&&t.metaData})}},b.notifyHttpError=function(e,t,r){h({type:"httpError",req:e,res:t,user:r&&r.user,metaData:r&&r.metaData})},e.addEventListener&&e.addEventListener("unhandledrejection",function(e){b.notifyError(e.reason)}),e.addEventListener&&e.addEventListener("error",l,!0);var k=[];e.addEventListener?e.addEventListener("click",d,!0):document.attachEvent("onclick",d);var D={url:e.location.href};document.addEventListener?document.addEventListener("DOMContentLoaded",function(){D={url:e.location.href,title:document.title}}):document.attachEvent("onreadystatechange",function(){D={url:e.location.href,title:document.title}});var w=e.onpopstate;e.onpopstate=function(){var t={url:e.location.href};if(D.title||(D.title=document.title),D.url!==t.url&&g(D,t),w)return w.apply(this,arguments)};var H=e.history.pushState;e.history.pushState=function(){D={url:e.location.href,title:document.title};var t={};if(3===arguments.length&&(t.url=arguments[2]),D.url!==t.url&&g(D,t),H)return H.apply(this,arguments)};var x=e.onhashchange;e.onhashchange=function(){var t={url:e.location.href,title:document.title};if(D.url!==t.url&&g(D,t),x)return x.apply(this,arguments)};var M=!1;if(e.XMLHttpRequest){var S=XMLHttpRequest.prototype;if(!S)return;var R,q,_=S.open;S.open=function(e,t){R=e,q=t;try{_.apply(this,arguments)}catch(e){M=!0,b.notifyError(e,{metaData:{description:"XMLHttpRequest请求失败(如果是拒绝访问，则是由于浏览器跨域限制)",method:R,httpUrl:q}})}};var A=S.send;S.send=function(){if(M)return void(M=!1);var t=this,r=t.onreadystatechange;t.onreadystatechange=function(){if(4===t.readyState&&!t.Fundebug&&q!=N){var n={type:"XMLHttpRequest",page:{url:e.location.href},detail:{method:R,url:t.responseURL||q,status:t.status,statusText:t.statusText},time:(new Date).getTime()};if(v(n)){var a={method:n.detail.method,url:n.detail.url},i={status:t.status,statusText:t.statusText,response:t.response};b.notifyHttpError(a,i)}p(n)}r&&r.apply(this,arguments)},A.apply(this,arguments)}}if(e.fetch){var j=e.fetch;e.fetch=function(t,r){return j.apply(this,arguments).then(function(t){var n={type:"fetch",page:{url:e.location.href,title:document.title},detail:{method:r&&r.method||"GET",url:t.url,status:t.status,statusText:t.statusText},time:(new Date).getTime()};if(v(n)){var a={method:n.detail.method,url:n.detail.url},i={status:t.status,statusText:t.statusText};b.notifyHttpError(a,i)}return p(n),t})}}var O="function"==typeof define,X="undefined"!=typeof module&&module.exports;O?define(b):X&&(module.exports=b)}(window);